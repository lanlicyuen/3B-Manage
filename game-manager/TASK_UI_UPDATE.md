# 任务功能更新说明 - v2

## 🎉 新增功能

### 1. 任务管理界面
现在你可以直接在网页上管理任务了！

**访问方式：**
- 登录后，在顶部导航栏点击 **🎯 任务管理**
- 或直接访问: http://localhost:20001/tasks

**功能特性：**
- ✅ 创建新任务（设置名称、分类、描述、排序）
- ✅ 编辑现有任务
- ✅ 删除任务（软删除，不影响历史数据）
- ✅ 按分类查看任务列表
- ✅ 实时生效（创建后立即可在事件创建时使用）

### 2. 创建事件时选择任务
**现在的流程：**
1. 点击"➕ 创建事件"
2. 在"任务"字段，从下拉列表选择（不再是输入框）
3. 任务按分类组织：
   - 公会战
   - 副本
   - 活动
   - 日常
   - 其他

## 📋 使用步骤

### 第一步：管理任务（首次使用）
1. 登录系统（点击"总督请进"）
2. 点击导航栏的 **🎯 任务管理**
3. 在"创建新任务"区域：
   - **任务名称**: 例如"空城首占"
   - **分类**: 选择"公会战"
   - **排序**: 设置显示顺序（数字越小越靠前）
   - **描述**: 可选说明
4. 点击 **➕ 创建任务**

**系统已预置8个常用任务：**
- 空城首占（公会战）
- 城池争夺（公会战）
- 防守战（公会战）
- 副本推进（副本）
- BOSS挑战（副本）
- 世界BOSS（活动）
- 公会任务（日常）
- 其他活动（其他）

### 第二步：创建事件使用任务
1. 点击 **➕ 创建事件**
2. 填写日期和标题
3. 在"任务"下拉列表中选择（按分类分组）
4. 选择参与成员
5. 创建事件

### 第三步：查看统计
1. 进入 **📈 报表导出**
2. 滚动到"任务参与统计"
3. 设置日期范围
4. 可选：筛选特定任务
5. 点击"查询统计"查看结果

## 🔧 解决的问题

### 问题1：创建事件时看不到下拉选择
**原因：** 前端代码需要重新构建
**已解决：** ✅ 已重新构建和部署

### 问题2：没有地方创建新任务
**原因：** 之前只有API，没有管理界面
**已解决：** ✅ 新增任务管理页面

## 🖼️ 界面预览

### 任务管理页面
```
🎯 任务管理                              ← 返回首页

创建新任务
┌─────────────────────────────────────────────────┐
│ 任务名称: [________________]                     │
│ 分类: [▼ 公会战]  排序: [0]                     │
│ 描述: [________________________________]         │
│ [➕ 创建任务]                                    │
└─────────────────────────────────────────────────┘

现有任务列表
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
公会战
  • 空城首占           [编辑] [删除]
  • 城池争夺           [编辑] [删除]
  • 防守战            [编辑] [删除]

副本
  • 副本推进           [编辑] [删除]
  • BOSS挑战           [编辑] [删除]
...
```

### 创建事件 - 任务选择
```
任务
┌─────────────────────────────────────┐
│ -- 请选择任务 --                ▼   │
├─────────────────────────────────────┤
│ 公会战                               │
│   空城首占                           │
│   城池争夺                           │
│   防守战                             │
├─────────────────────────────────────┤
│ 副本                                 │
│   副本推进                           │
│   BOSS挑战                           │
└─────────────────────────────────────┘
💡 选择预定义的任务类型，便于后续统计分析
```

## 🌐 访问地址

- **本地访问**: http://localhost:20001
- **Nginx代理**: 根据你的Nginx配置

## 💡 小贴士

1. **任务名称标准化**
   - 同样的活动使用同样的任务名
   - 便于后续统计分析
   - 例如：所有空城首占都选"空城首占"任务

2. **分类管理**
   - 按活动类型分类便于查找
   - 建议的分类：公会战、副本、活动、日常、其他

3. **排序优化**
   - 常用任务设置较小的排序值
   - 这样在下拉列表中会优先显示

4. **删除vs停用**
   - 删除操作是"软删除"（is_active=0）
   - 历史事件记录不受影响
   - 只是不再出现在下拉列表中

## 📊 数据示例

根据你的Excel数据（12/15/2025 北地 - 空城首占），现在可以：

1. **创建任务** "空城首占" （分类：公会战）
2. **创建事件**
   - 日期: 2025-12-15
   - 标题: 北地
   - 任务: [下拉选择] 空城首占
   - 成员: 小樱桃、绿叶成阴等...
3. **统计查询**
   - 查看"空城首占"任务的所有参与记录
   - 查看每个成员参与"空城首占"的次数

## ⚠️ 注意事项

1. **清除浏览器缓存**
   如果还是看到旧界面，按 `Ctrl+F5` 强制刷新

2. **需要登录**
   任务管理功能需要管理员权限

3. **任务名称不能重复**
   创建任务时如果提示"任务名称已存在"，说明已有同名任务

## 🆘 遇到问题？

### 还是看不到下拉框？
```bash
# 清除浏览器缓存并强制刷新
Ctrl + F5

# 或者在开发者工具中清除缓存
F12 → Network → Disable cache
```

### 任务管理页面打不开？
```bash
# 检查服务状态
cd /home/lanlic/Html-Project/3b-manage/game-manager
./manage_services.sh status

# 重启服务
./manage_services.sh restart
```

### API错误？
```bash
# 查看后端日志
journalctl -u 3b-manage-backend.service -f
```

## 🎯 下一步建议

使用任务管理功能标准化你的活动记录：
1. 先在任务管理中创建你常用的活动类型
2. 以后创建事件时统一从下拉列表选择
3. 定期使用任务参与统计查看成员活跃度

这样数据会更规范，统计也更准确！
