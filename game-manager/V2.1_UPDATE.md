# V2.1 æƒé™ç³»ç»Ÿä¸åŠŸèƒ½å¢å¼º - æ›´æ–°è¯´æ˜

## ğŸ“… æ›´æ–°æ—¥æœŸï¼š2025-12-15

---

## ğŸ¯ æœ¬æ¬¡æ›´æ–°å†…å®¹

### 1. âœ… æƒé™æ§åˆ¶ç³»ç»Ÿ

#### åç«¯å®ç°
- **æ–°å¢æ–‡ä»¶**ï¼š`server/middleware/auth.js` - è®¤è¯ä¸­é—´ä»¶
- **æ–°å¢æ–‡ä»¶**ï¼š`server/routes/admin.js` - ç®¡ç†å‘˜ç™»å½•è·¯ç”±
- **ä¿®æ”¹æ–‡ä»¶**ï¼šæ‰€æœ‰ç®¡ç†å‹APIæ·»åŠ `requireAuth`ä¸­é—´ä»¶ä¿æŠ¤

#### ç®¡ç†æ¥å£ä¿æŠ¤ï¼ˆéœ€è¦tokenï¼‰
- POST /api/members - åˆ›å»ºæˆå‘˜
- PUT /api/members/:id - æ›´æ–°æˆå‘˜
- DELETE /api/members/:id - åˆ é™¤æˆå‘˜
- POST /api/members/import-json - æ‰¹é‡å¯¼å…¥
- POST /api/events - åˆ›å»ºäº‹ä»¶
- PUT /api/events/:id - æ›´æ–°äº‹ä»¶
- DELETE /api/events/:id - åˆ é™¤äº‹ä»¶
- POST /api/events/:id/export-txt - å¯¼å‡ºTXT
- GET /api/reports/export-csv - å¯¼å‡ºæŠ¥è¡¨

#### åªè¯»æ¥å£ï¼ˆæ— éœ€tokenï¼‰
- GET /api/members
- GET /api/events
- GET /api/events/range
- GET /api/events/:id
- GET /api/meta

#### ç™»å½•æ¥å£
- **POST /api/admin/login** - ç®¡ç†å‘˜ç™»å½•
  - Body: `{"password": "12345aBc"}`
  - è¿”å›: `{"token": "...", "message": "ç™»å½•æˆåŠŸ"}`
  - å¯†ç ç¡¬ç¼–ç ï¼š`12345aBc`
- **POST /api/admin/logout** - é€€å‡ºç™»å½•

### 2. âœ… æˆå‘˜ç®¡ç†å¢å¼º

#### æ–°å¢åŠŸèƒ½
- **ç¼–è¾‘æˆå‘˜**ï¼šè¡¨æ ¼è¡Œå†…ç¼–è¾‘å§“åå’Œå¤‡æ³¨
  - ç‚¹å‡»"ç¼–è¾‘"è¿›å…¥ç¼–è¾‘æ¨¡å¼
  - è¾“å…¥æ¡†æ”¯æŒEnterä¿å­˜ã€ESCå–æ¶ˆ
  - è°ƒç”¨ PUT /api/members/:id

#### ä¿®æ”¹æ–‡ä»¶
- `client/src/views/MembersView.vue` - æ·»åŠ ç¼–è¾‘åŠŸèƒ½
- `server/routes/members.js` - æ·»åŠ PUTæ¥å£

### 3. âœ… äº‹ä»¶åˆ—è¡¨é¡µ

#### æ–°å¢æ–‡ä»¶
- `client/src/views/EventsListView.vue` - äº‹ä»¶åˆ—è¡¨è§†å›¾

#### åŠŸèƒ½ç‰¹æ€§
- æ˜¾ç¤ºæ‰€æœ‰äº‹ä»¶ï¼ˆé»˜è®¤æœ€è¿‘365å¤©ï¼‰
- æœç´¢ï¼šæ ‡é¢˜å…³é”®è¯
- ç­›é€‰ï¼šå¼€å§‹æ—¥æœŸã€ç»“æŸæ—¥æœŸ
- æ˜¾ç¤ºå­—æ®µï¼šæ—¥æœŸã€æ ‡é¢˜ã€ä»»åŠ¡ã€å¤‡æ³¨ã€å‚ä¸äººæ•°
- ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…è·³è½¬åˆ°EventDetail

#### åç«¯æ”¯æŒ
- **GET /api/events** - äº‹ä»¶åˆ—è¡¨æ¥å£
  - å‚æ•°ï¼šfrom, to, q
  - è¿”å›ï¼šåŒ…å«member_countçš„äº‹ä»¶åˆ—è¡¨

### 4. âœ… å‰ç«¯æƒé™æ§åˆ¶

#### æ–°å¢æ–‡ä»¶
- `client/src/components/LoginModal.vue` - ç™»å½•å¼¹çª—ç»„ä»¶

#### ä¿®æ”¹æ–‡ä»¶
- `client/src/api.js`
  - æ·»åŠ `getAuthHeaders()`è¾…åŠ©å‡½æ•°
  - æ‰€æœ‰ç®¡ç†è¯·æ±‚è‡ªåŠ¨å¸¦Authorizationå¤´
  - æ–°å¢`adminLogin()`å’Œ`adminLogout()`
  
- `client/src/router.js`
  - æ·»åŠ è·¯ç”±å®ˆå«`beforeEach`
  - æœªç™»å½•è®¿é—®ç®¡ç†é¡µè‡ªåŠ¨è·³è½¬é¦–é¡µ
  - æ–°å¢`/events`è·¯ç”±ï¼ˆäº‹ä»¶åˆ—è¡¨ï¼‰

- `client/src/views/MatrixView.vue`
  - æ ¹æ®ç™»å½•çŠ¶æ€æ˜¾ç¤ºä¸åŒå¯¼èˆªæŒ‰é’®
  - æœªç™»å½•ï¼šåªæ˜¾ç¤º"ğŸ” æ€»ç£è¯·è¿›"
  - å·²ç™»å½•ï¼šæ˜¾ç¤ºæ‰€æœ‰ç®¡ç†åŠŸèƒ½ + "ğŸšª é€€å‡º"
  - é›†æˆLoginModalç»„ä»¶

### 5. âœ… æ–‡æ¡£æ›´æ–°

- **README.md** - æ·»åŠ æƒé™å’Œç™»å½•è¯´æ˜
- **æœ¬æ–‡ä»¶** - å®Œæ•´æ›´æ–°è®°å½•

---

## ğŸš€ ä½¿ç”¨æŒ‡å—

### æ¸¸å®¢æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰
1. è®¿é—® http://localhost:20001
2. å¯ä»¥æŸ¥çœ‹ç‚¹é˜µå‡ºå‹¤è¡¨
3. å¯ä»¥ç‚¹å‡»å•å…ƒæ ¼æŸ¥çœ‹äº‹ä»¶è¯¦æƒ…
4. **ä¸èƒ½**è¿›è¡Œä»»ä½•ç®¡ç†æ“ä½œ

### æ€»ç£æ¨¡å¼ï¼ˆç™»å½•åï¼‰
1. ç‚¹å‡»å³ä¸Šè§’"ğŸ” æ€»ç£è¯·è¿›"
2. è¾“å…¥å¯†ç ï¼š`12345aBc`
3. ç™»å½•æˆåŠŸåå¯¼èˆªæ æ˜¾ç¤ºæ‰€æœ‰ç®¡ç†åŠŸèƒ½
4. å¯ä»¥ï¼š
   - ç®¡ç†æˆå‘˜ï¼ˆæ·»åŠ /ç¼–è¾‘/åˆ é™¤/å¯¼å…¥ï¼‰
   - åˆ›å»ºå’Œç¼–è¾‘äº‹ä»¶
   - æŸ¥çœ‹å®Œæ•´äº‹ä»¶åˆ—è¡¨
   - å¯¼å‡ºæŠ¥è¡¨
5. ç‚¹å‡»"ğŸšª é€€å‡º"è¿”å›æ¸¸å®¢æ¨¡å¼

---

## ğŸ“‚ æ–°å¢/ä¿®æ”¹æ–‡ä»¶æ¸…å•

### åç«¯æ–°å¢
```
server/middleware/auth.js         # è®¤è¯ä¸­é—´ä»¶
server/routes/admin.js            # ç®¡ç†å‘˜ç™»å½•è·¯ç”±
```

### åç«¯ä¿®æ”¹
```
server/server.js                  # å¼•å…¥adminè·¯ç”±
server/routes/members.js          # æ·»åŠ PUTæ¥å£ + æƒé™ä¿æŠ¤
server/routes/events.js           # æ·»åŠ GET /eventsæ¥å£ + æƒé™ä¿æŠ¤
server/routes/reports.js          # æ·»åŠ æƒé™ä¿æŠ¤
```

### å‰ç«¯æ–°å¢
```
client/src/components/LoginModal.vue    # ç™»å½•å¼¹çª—
client/src/views/EventsListView.vue     # äº‹ä»¶åˆ—è¡¨é¡µ
```

### å‰ç«¯ä¿®æ”¹
```
client/src/api.js                 # Tokenå¤„ç† + æ–°æ¥å£
client/src/router.js              # è·¯ç”±å®ˆå« + æ–°è·¯ç”±
client/src/views/MatrixView.vue   # ç™»å½•å…¥å£ + æƒé™å¯¼èˆª
client/src/views/MembersView.vue  # ç¼–è¾‘åŠŸèƒ½
```

### æ–‡æ¡£ä¿®æ”¹
```
README.md                         # æ·»åŠ æƒé™è¯´æ˜
```

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### 1. æµ‹è¯•ç™»å½•
```bash
# é”™è¯¯å¯†ç 
curl -X POST http://localhost:20002/api/admin/login \
  -H "Content-Type: application/json" \
  -d '{"password":"wrong"}'
# æœŸæœ›ï¼š401 å¯†ç é”™è¯¯

# æ­£ç¡®å¯†ç 
curl -X POST http://localhost:20002/api/admin/login \
  -H "Content-Type: application/json" \
  -d '{"password":"12345aBc"}'
# æœŸæœ›ï¼š200 è¿”å›token
```

### 2. æµ‹è¯•æƒé™ä¿æŠ¤
```bash
# æœªç™»å½•åˆ›å»ºæˆå‘˜
curl -X POST http://localhost:20002/api/members \
  -H "Content-Type: application/json" \
  -d '{"name":"æµ‹è¯•"}'
# æœŸæœ›ï¼š401 éœ€è¦æ€»ç£ç™»å½•

# ç™»å½•ååˆ›å»ºï¼ˆéœ€è¦æ›¿æ¢YOUR_TOKENï¼‰
curl -X POST http://localhost:20002/api/members \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{"name":"æµ‹è¯•"}'
# æœŸæœ›ï¼š201 åˆ›å»ºæˆåŠŸ
```

### 3. æµ‹è¯•å‰ç«¯åŠŸèƒ½
1. è®¿é—® http://localhost:20001
2. éªŒè¯å¯¼èˆªæ åªæ˜¾ç¤º"æ€»ç£è¯·è¿›"
3. å°è¯•è®¿é—® /membersï¼Œåº”è¢«æ‹¦æˆªè·³è½¬é¦–é¡µ
4. ç‚¹å‡»"æ€»ç£è¯·è¿›"ï¼Œè¾“å…¥`12345aBc`
5. éªŒè¯å¯¼èˆªæ æ˜¾ç¤ºæ‰€æœ‰ç®¡ç†æŒ‰é’®
6. æµ‹è¯•æˆå‘˜ç¼–è¾‘åŠŸèƒ½
7. æµ‹è¯•äº‹ä»¶åˆ—è¡¨é¡µæœç´¢å’Œç­›é€‰
8. ç‚¹å‡»"é€€å‡º"ï¼ŒéªŒè¯è¿”å›æ¸¸å®¢æ¨¡å¼

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å¯†ç ç¡¬ç¼–ç **ï¼šå½“å‰å¯†ç `12345aBc`å†™åœ¨`server/routes/admin.js`ä¸­ï¼Œç”Ÿäº§ç¯å¢ƒåº”ä½¿ç”¨ç¯å¢ƒå˜é‡
2. **Tokenå­˜å‚¨**ï¼šTokenå­˜åœ¨å†…å­˜Mapä¸­ï¼ŒæœåŠ¡å™¨é‡å¯åå¤±æ•ˆ
3. **ä¼šè¯ç®¡ç†**ï¼šTokenå­˜åœ¨localStorageï¼Œå…³é—­æµè§ˆå™¨ä¸ä¼šå¤±æ•ˆ
4. **HTTPS**ï¼šç”Ÿäº§ç¯å¢ƒå»ºè®®å¯ç”¨HTTPSä¿æŠ¤tokenä¼ è¾“
5. **ç«¯å£å ç”¨**ï¼šç¡®ä¿20001å’Œ20002ç«¯å£å¯ç”¨

---

## ğŸ‰ å®ŒæˆçŠ¶æ€

- âœ… åç«¯è®¤è¯ä¸­é—´ä»¶
- âœ… ç®¡ç†æ¥å£æƒé™ä¿æŠ¤
- âœ… å‰ç«¯ç™»å½•å¼¹çª—
- âœ… æˆå‘˜ç¼–è¾‘åŠŸèƒ½
- âœ… äº‹ä»¶åˆ—è¡¨é¡µ
- âœ… è·¯ç”±å®ˆå«
- âœ… å¯¼èˆªæ æƒé™æ§åˆ¶
- âœ… æ–‡æ¡£æ›´æ–°

**é¡¹ç›®çŠ¶æ€**ï¼šğŸŸ¢ æ‰€æœ‰åŠŸèƒ½å·²å®Œæˆå¹¶æµ‹è¯•é€šè¿‡
